<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Boulangerie PÃ¢tisserie Cointe - Gestion</title>
  <link rel="stylesheet" href="./style.css?v=1" />
  <meta name="theme-color" content="#2ecc71" />
</head>
<body>

<header class="header">
  <h1>Boulangerie PÃ¢tisserie Cointe - Gestion</h1>

  <div class="topbar">
    <div class="topbar-item">
      <div class="small">Boulangerie (pour rapports)</div>
      <input id="bakeryName" type="text" placeholder="Ex : Boulangerie PÃ¢tisserie Cointe" />
    </div>
    <div class="topbar-item">
      <div class="small">EmployÃ© (obligatoire)</div>
      <select id="employeeSelect"></select>
      <div class="small">SÃ©lectionne lâ€™employÃ© avant dâ€™enregistrer.</div>
    </div>
</div>
  </div>

  <nav class="tabs">
    <button class="tab active" data-tab="temperatures">ğŸŒ¡ï¸ TempÃ©ratures</button>
    <button class="tab" data-tab="hygiene">ğŸ§¹ HygiÃ¨ne</button>
    <button class="tab" data-tab="inventaire">ğŸ“¦ Inventaire</button>
    <button class="tab" data-tab="notes">ğŸ“ Notes</button>
    <button class="tab patron-only" data-tab="stats">ğŸ“Š Stats</button>
    <button class="tab" data-tab="inspection">ğŸ§¾ Inspection</button>
    <button class="tab patron-only" data-tab="suivi">âœ… Suivi</button>
    <button class="tab" data-tab="patron">ğŸ‘‘ Patron</button>
  </nav>
</header>

<div id="notifs" class="notifs"></div>

<!-- ONGLET TEMPÃ‰RATURES -->
<section id="temperatures" class="panel active">
  <div class="row row-split">
    <div>
      <label for="periode" class="label">PÃ©riode</label>
      <select id="periode">
        <option value="matin">Matin</option>
        <option value="apres-midi">AprÃ¨s-midi</option>
      </select>
    </div>
    <div>
      <div class="small">EmployÃ©</div>
      <div id="tempsEmp" class="small">â€”</div>
    </div>
  </div>

  <div id="zones"></div>

  <div class="actions">
    <button id="btnSaveTemps">ğŸ’¾ Enregistrer</button>
    <button id="btnValidateDay" class="secondary">âœ… Valider la journÃ©e</button>
    <button id="btnAddCorrectiveTemp" class="secondary">â• Action corrective (temp)</button>
    <button id="btnExportTempsCSV">ğŸ“„ Export CSV</button>
    <button id="btnExportTempsPDF">ğŸ–¨ï¸ Export PDF</button>
    <button id="btnChart">ğŸ“Š Mettre Ã  jour le graphique</button>
  </div>

  <h2>Alertes du jour</h2>
  <div id="tempAlertsList"></div>

  <h2>Graphique (derniÃ¨res valeurs)</h2>
  <canvas id="chartTemps" height="220"></canvas>
</section>

<!-- ONGLET HYGIÃˆNE -->
<section id="hygiene" class="panel">
  <h2>HygiÃ¨ne / Nettoyage</h2>
  <div class="row row-split">
    <div>
      <label for="hygieneDate" class="label">Date</label>
      <input id="hygieneDate" type="date" />
    </div>
    <div>
      <label for="hygienePeriode" class="label">PÃ©riode</label>
      <select id="hygienePeriode">
        <option value="matin">Matin</option>
        <option value="apres-midi">AprÃ¨s-midi</option>
      </select>
    </div>
  </div>

  <div class="card">
    <div class="card-title">EmployÃ©</div>
    <div id="hygieneEmp" class="small">â€”</div>
  </div>

  <div id="taches"></div>

  <div class="actions">
    <button id="btnSaveHygiene">ğŸ’¾ Enregistrer</button>
    <button id="btnExportHygieneCSV">ğŸ“„ Export CSV</button>
    <button id="btnExportHygienePDF">ğŸ–¨ï¸ Export PDF</button>
  </div>
</section>

<!-- ONGLET INVENTAIRE -->
<section id="inventaire" class="panel">
  <h2>Inventaire / PÃ©remption</h2>

  <div class="card">
    <div class="card-title">â• Ajouter un produit au catalogue</div>
    <div class="row row-split">
      <div>
        <div class="small">Nom du produit</div>
        <input type="text" id="newProdName" placeholder="Ex : Mozzarella">
      </div>
      <div>
        <div class="small">UnitÃ©</div>
        <input type="text" id="newProdUnit" placeholder="kg / L / piÃ¨ces">
      </div>
      <div>
        <div class="small">Stock mini (alerte)</div>
        <input type="number" step="0.1" id="newProdMin" placeholder="Ex : 10">
      </div>
    </div>
    <div class="row">
      <div style="flex:1;">
        <div class="small">CatÃ©gorie</div>
        <select id="newProdCat">
          <option value="boulangerie">Boulangerie</option>
          <option value="patisserie">PÃ¢tisserie</option>
          <option value="snacking">Snacking</option>
          <option value="hygiene">HygiÃ¨ne</option>
          <option value="autre">Autre</option>
        </select>
      </div>
    </div>
    <div class="actions">
      <button id="btnAddProduct">âœ… Ajouter au catalogue</button>
      <button id="btnResetProducts" class="secondary">â†©ï¸ Catalogue par dÃ©faut</button>
    </div>
    <div class="small">Le catalogue sert Ã  retrouver rapidement tes produits dans la liste ci-dessous.</div>
  </div>

  <div class="row row-split">
    <div>
      <label class="label">Filtre</label>
      <select id="invCatFilter">
        <option value="all">Tous</option>
        <option value="boulangerie">Boulangerie</option>
        <option value="patisserie">PÃ¢tisserie</option>
        <option value="snacking">Snacking</option>
        <option value="hygiene">HygiÃ¨ne</option>
        <option value="autre">Autre</option>
      </select>
    </div>
    <div class="small" style="align-self:end;">
      Astuce : filtre pour retrouver vite un produit
    </div>
  </div>

  <div class="row row-split">
    <div>
      <label for="invProduit" class="label">Produit</label>
      <select id="invProduit"></select>
    </div>
    <div>
      <label for="invDate" class="label">Date</label>
      <input id="invDate" type="date" />
    </div>
  </div>

  <div class="card">
    <div class="card-title">EmployÃ©</div>
    <div id="invEmp" class="small">â€”</div>
  </div>

  <div class="card" id="invStockCard">
    <div class="card-title">Stock (calculÃ©)</div>
    <div id="invStockInfo" class="small">â€”</div>
  </div>

  <div class="card">
    <div class="card-title">Tri / affichage</div>
    <div class="row">
      <label><input type="checkbox" id="invSortByExp" checked> Trier par DLC la plus proche</label>
    </div>
    <div class="small">Astuce : pour le contrÃ´le, trier par DLC est plus lisible.</div>
  </div>

  <div id="invForm"></div>

  <div class="actions">
    <button id="btnAddInv">â• Ajouter entrÃ©e produit</button>
    <button id="btnRiskInv">âš ï¸ Produits Ã  risque</button>
    <button id="btnInvHistoryAll" class="secondary">ğŸ“œ Historique complet</button>
    <button id="btnExportRiskCSV" class="secondary">ğŸ“„ Export Risque CSV</button>
    <button id="btnExportRiskPDF" class="secondary">ğŸ–¨ï¸ Export Risque PDF</button>
    <button id="btnExportInvCSV">ğŸ“„ Export CSV (produit)</button>
    <button id="btnExportInvPDF">ğŸ–¨ï¸ Export PDF (produit)</button>
    <button id="btnExportInvAllCSV" class="secondary">ğŸ“„ Export CSV (complet)</button>
    <button id="btnExportInvAllPDF" class="secondary">ğŸ–¨ï¸ Export PDF (complet)</button>
    <button id="btnDeleteProduct" class="secondary">ğŸ—‘ï¸ Supprimer ce produit</button>
    <button id="btnAddCorrectiveInv" class="secondary">â• Action corrective (inv)</button>
  </div>

  
  <div id="invHistoryFilters" class="card" style="display:none;">
    <div class="card-title">Filtres historique complet</div>
    <div class="row row-split">
      <div>
        <div class="small">Du</div>
        <input id="invFrom" type="date" />
      </div>
      <div>
        <div class="small">Au</div>
        <input id="invTo" type="date" />
      </div>
    </div>
    <div class="row row-split">
      <div>
        <div class="small">Recherche produit</div>
        <input id="invSearch" type="text" placeholder="Ex : farine / beurre..." />
      </div>
      <div>
        <div class="small">CatÃ©gorie</div>
        <select id="invCatFilterAll">
          <option value="all">Toutes</option>
          <option value="boulangerie">Boulangerie</option>
          <option value="patisserie">PÃ¢tisserie</option>
          <option value="snacking">Snacking</option>
          <option value="hygiene">HygiÃ¨ne</option>
          <option value="autre">Autre</option>
        </select>
      </div>
    </div>
    <div class="actions">
      <button id="btnApplyInvFilters" class="secondary">ğŸ” Appliquer</button>
      <button id="btnClearInvFilters" class="secondary">â™»ï¸ RÃ©initialiser</button>
    </div>
    <div class="small">Astuce : ces filtres sâ€™appliquent aussi aux exports â€œcompletâ€.</div>
  </div>

<h3 id="invListeTitle">Historique du produit</h3>
  <div id="invListe"></div>
</section>

<!-- ONGLET NOTES -->
<section id="notes" class="panel">
  <h2>Notes / Observations</h2>

  <div class="row">
    <label for="notesDate" class="label">Date</label>
    <input id="notesDate" type="date" />
  </div>

  <textarea id="notesTexte" rows="10" placeholder="Ex : anomalie tempÃ©rature, intervention technicien, nettoyage exceptionnel..."></textarea>

  <div class="actions">
    <button id="btnSaveNotes">ğŸ’¾ Enregistrer</button>
    <button id="btnExportNotesCSV">ğŸ“„ Export CSV</button>
    <button id="btnExportNotesPDF">ğŸ–¨ï¸ Export PDF</button>
  </div>

  <h3>Historique</h3>
  <div id="notesListe"></div>
</section>

<!-- ONGLET STATS -->
<section id="stats" class="panel">
  <h2>Statistiques mensuelles</h2>
  <div class="row row-split">
    <div>
      <label class="label">Mois</label>
      <input id="statsMonth" type="month" />
    </div>
    <div>
      <button id="btnRefreshStats" class="secondary">ğŸ”„ Actualiser</button>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="card-title">TempÃ©ratures</div>
      <div id="statsTemps" class="small"></div>
      <canvas id="chartStatsTemps" height="220"></canvas>
    </div>
    <div class="card">
      <div class="card-title">HygiÃ¨ne</div>
      <div id="statsHyg" class="small"></div>
      <canvas id="chartStatsHyg" height="220"></canvas>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="card-title">Inventaire</div>
      <div id="statsInv" class="small"></div>
      <canvas id="chartStatsInv" height="220"></canvas>
    </div>
    <div class="card">
      <div class="card-title">Notes</div>
      <div id="statsNotes" class="small"></div>
    </div>
  </div>
</section>

<!-- ONGLET INSPECTION -->
<section id="inspection" class="panel">
  <h2>Rapport inspection sanitaire</h2>
  <div class="small">GÃ©nÃ¨re un PDF propre (tempÃ©ratures, hygiÃ¨ne, inventaire, notes) pour un mois donnÃ©.</div>
  <div class="row row-split">
    <div>
      <label class="label">Mois</label>
      <input id="inspMonth" type="month" />
    </div>
    <div>
      <button id="btnGenerateInspection" class="secondary">ğŸ§¾ GÃ©nÃ©rer PDF inspection</button>
    </div>
  </div>
  <div class="card">
    <div class="card-title">Options</div>
    <div class="row">
      <label><input type="checkbox" id="inspIncludeNotes" checked /> Inclure notes</label>
    </div>
  </div>
</section>


<!-- ONGLET SUIVI -->
<section id="suivi" class="panel">
  <h2>Suivi / Journal (validations & actions)</h2>
  <div class="small">Ici tu retrouves les validations de journÃ©e et les actions correctives (utile en inspection).</div>

  <div class="row row-split">
    <div>
      <label class="label">Mois</label>
      <input id="suiviMonth" type="month" />
    </div>
    <div>
      <button id="btnRefreshSuivi" class="secondary">ğŸ”„ Actualiser</button>
    </div>
  </div>

  <div class="grid2">
    <div class="card">
      <div class="card-title">âœ… Validations de journÃ©e</div>
      <div id="validationsList"></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”§ Actions correctives</div>
      <div id="actionsList"></div>
    </div>
  </div>
</section>

<!-- MODAL ACTION CORRECTIVE -->
<div id="modalCorrective" class="modal" style="display:none;">
  <div class="modal-card">
    <div class="modal-title">â• Action corrective</div>
    <div class="row row-split">
      <div>
        <div class="small">CatÃ©gorie</div>
        <select id="corrCat">
          <option value="temperature">TempÃ©rature</option>
          <option value="inventaire">Inventaire</option>
          <option value="hygiene">HygiÃ¨ne</option>
          <option value="autre">Autre</option>
        </select>
      </div>
      <div>
        <div class="small">Date</div>
        <input id="corrDate" type="date" />
      </div>
    </div>
    <div class="row">
      <div style="flex:1;">
        <div class="small">Cible (zone / produit / Ã©lÃ©ment)</div>
        <input id="corrTarget" type="text" placeholder="Ex : CongÃ©lateur 1 / Farine T65" />
      </div>
    </div>
    <div class="row">
      <div style="flex:1;">
        <div class="small">Anomalie constatÃ©e</div>
        <textarea id="corrIssue" rows="3" placeholder="Ex : TempÃ©rature Ã  -12Â°C au lieu de -18Â°C"></textarea>
      </div>
    </div>
    <div class="row">
      <div style="flex:1;">
        <div class="small">Action corrective</div>
        <textarea id="corrAction" rows="3" placeholder="Ex : Produits dÃ©placÃ©s, contrÃ´le thermostat, appel technicien"></textarea>
      </div>
    </div>
    <div class="row row-split">
      <div class="small">EmployÃ© : <b id="corrEmp">â€”</b></div>
      <div class="actions" style="justify-content:flex-end;">
        <button id="btnSaveCorrective">ğŸ’¾ Enregistrer</button>
        <button id="btnCloseCorrective" class="secondary">Fermer</button>
      </div>
    </div>
  </div>
</div>


<!-- ONGLET PATRON -->
<section id="patron" class="panel">
  <h2>ğŸ‘‘ Menu Patron</h2>
  <div class="small">AccÃ¨s protÃ©gÃ© par code PIN. Ce menu contient la gestion des employÃ©s et lâ€™inspection.</div>

  <div id="patronLocked" class="card warn">
    <div class="card-title">Menu verrouillÃ©</div>
    <div class="small">Clique sur â€œDÃ©verrouillerâ€ et saisis le code PIN.</div>
    <div class="actions">
      <button id="btnPatronUnlock">ğŸ”“ DÃ©verrouiller</button>
    </div>
    <div class="small">PIN par dÃ©faut : <b>1234</b> (Ã  changer).</div>
  </div>

  <div id="patronContent" style="display:none;">
    <div class="card">
      <div class="card-title">ğŸ‘¤ Gestion des employÃ©s</div>
      <div class="small">Ajouter / supprimer des employÃ©s (rÃ©servÃ© Patron).</div>
      
    <div class="topbar-item">
      <div class="small">Gestion employÃ©s</div>
      <div class="row" style="margin:0">
        <input id="newEmployeeName" type="text" placeholder="Nom" />
        <button id="btnAddEmployee" class="secondary">+</button>
        <button id="btnDeleteEmployee" class="secondary">ğŸ—‘ï¸</button>
      </div>
      
    </div>

    <div class="card ok">
      <div class="card-title">AccÃ¨s patron actif</div>
      <div class="small">Les onglets â€œEmployÃ©sâ€ et â€œInspectionâ€ sont maintenant accessibles.</div>
      <div class="actions">
        <button id="btnPatronLock" class="secondary">ğŸ”’ Reverrouiller</button>
      </div>
    </div>

    <div class="card">
      <div class="card-title">AccÃ¨s rapides</div>
      <div class="actions">
        <button id="btnOpenEmployees">ğŸ‘¤ Gestion employÃ©s</button>
        <button id="btnOpenInspection">ğŸ§¾ Inspection</button>
        <button id="btnOpenStats" class="secondary">ğŸ“Š Stats</button>
        <button id="btnOpenSuivi" class="secondary">âœ… Suivi</button>
</div>
      <div class="small">Astuce : utilise â€œInspectionâ€ pour gÃ©nÃ©rer un rapport complet 1 clic.</div>
    </div>
<div class="card">
      
    <div class="card">
      <div class="card-title">â±ï¸ DurÃ©e avant reverrouillage automatique</div>
      <div class="small">Le menu Patron se reverrouille aprÃ¨s inactivitÃ©.</div>
      <div class="row row-split">
        <div>
          <select id="patronLockMinutes">
            <option value="2">2 minutes</option>
            <option value="5" selected>5 minutes</option>
            <option value="10">10 minutes</option>
          </select>
        </div>
      </div>
    </div>

<div class="card-title">Changer le PIN</div>

      <div class="row row-split">
        <div>
          <div class="small">Nouveau PIN (4 Ã  8 chiffres)</div>
          <input id="patronNewPin" type="password" inputmode="numeric" placeholder="Ex : 2580">
        </div>
        <div>
          <div class="small">Confirmer</div>
          <input id="patronNewPin2" type="password" inputmode="numeric" placeholder="RÃ©pÃ©ter">
        </div>
      </div>
      <div class="actions">
        <button id="btnPatronChangePin" class="secondary">ğŸ’¾ Enregistrer</button>
      </div>
    </div>
  </div>
</section>

<!-- MODAL PIN PATRON -->
<div id="patronPinModal" class="modal" style="display:none;">
  <div class="modal-card">
    <div class="modal-title">ğŸ”’ Code Patron</div>
    <div class="small">Saisis le PIN pour dÃ©verrouiller.</div>
    <div class="row">
      <div style="flex:1;">
        <input id="patronPinInput" type="password" inputmode="numeric" placeholder="PIN">
      </div>
    </div>
    <div class="actions" style="justify-content:flex-end;">
      <button id="btnPatronPinOk">OK</button>
      <button id="btnPatronPinCancel" class="secondary">Annuler</button>
    </div>
    <div id="patronPinError" class="small" style="color:#c0392b; display:none; margin-top:6px;">PIN incorrect.</div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script defer src="./app.js?v=1"></script>
</body>
</html>
